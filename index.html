<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>mackyle/blocksruntime @ GitHub</title>

  <style type="text/css">
    body {
      margin-top: 1.0em;
      background-color: white;
      font-family: Times, "Times New Roman", serif;
      color: black;
    }
    #container {
      margin: 0 auto;
      max-width: 90ex;
      position: relative;
    }
    h1 { font-size: 3.8em; color: black; margin-bottom: 0.1em; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none; }
    h2 { font-size: 1.5em; color: black; }
    h3 { text-align: center; color: black; }
    h1, h2, h3 { font-family: Helvetica, Arial, FreeSans, sans-serif; font-weight: normal; }
    a { color: black; }
    .description { font-size: 1.2em; margin-bottom: 2em; margin-top: 2em; font-style: italic; }
    .download { float: right; }
    pre, tt { font-family: Menlo, Monaco, Consolas, Courier, "Courier New", monospace; font-size: 95%;}
    pre { padding: 0.5em 1ex; border: thin dotted silver; }
    hr { border: 0; width: 80%; border-bottom: thin solid silver; }
    p { text-align: justify; }
    p.left { text-align: left; }
    .bigger {font-size: 112%; }
    li { margin-top: 0.5em; }
    #TOC span {
      display: inline-block;
      margin-left: 8px
    }
    .sidebar {
      display: float;
      position: absolute;
      left: -35ex;
      text-align: right;
      width: 30ex;
      font-size: 75%;
      margin: 0;
      padding: 2px;
    }
    .sidebar a:visited, .sidebar a:link {
      color: inherit;
      text-decoration: none;
      border-bottom: thin dotted gray;
    }
    .sidebar a:active {
      color: red;
    }
    .footer { text-align:center; padding-top:2em; font-style: italic; }
  </style>
</head>

<body>
  <a href="http://github.com/mackyle/blocksruntime"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

<div id="container">

<div class="download">
  <a href="http://github.com/mackyle/blocksruntime/zipball/master">
    <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
  <a href="http://github.com/mackyle/blocksruntime/tarball/master">
    <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
</div>

<h1><a href="http://github.com/mackyle/blocksruntime">blocksruntime</a>
  <!--<span class="small">by <a href="http://github.com/mackyle">mackyle</a></span>--></h1>

<div class="description">
  The libBlocksRuntime.a library from compiler-rt.
</div>

<span id="TOC" class="sidebar">
<b>Table of Contents</b><br /><span>
<a href="#"            >Overview</a><br />
<a href="#why"         >Why?</a><br />
<a href="#license"     >License</a><br />
<a href="#install"     >Install</a><br />
<a href="#download"    >Download</a><br />
<a href="#needs"       >Do I Need This?</a><br />
<a href="#blocksdox"   >Blocks Language Extension</a><br />
<a href="#github"      >GitHub</a><br />
</span></span>

<p>A clone of the compiler-rt library (<a href="http://compiler-rt.llvm.org/">http://compiler-rt.llvm.org/</a>) but only the BlocksRuntime library portion.  (Actually the compiler-rt master subversion source repository at http://llvm.org/svn/llvm-project/compiler-rt has an automatic git mirror at http://llvm.org/git/compiler-rt.git the refs/heads/master of which is cloned into refs/heads/compiler-rt of this repository.)

</p><p>

In addition to the clone of the BlocksRuntime library sources, a config.h file, testprefix.h file, a sample.c file and a few convenient shell scripts have been added in order to build, test and install the Block.h header and libBlocksRuntime.a library without needing cmake or make.

</p><p>

Any system which has a version of the clang compiler (either pre-installed or installable via any mechanism) with support for the -fblocks option should be supported.</p>  In particular, the FreeBSD, Linux, MacPorts and mingw versions of clang are known to work with the blocks runtime.

Your system may already come with the BlocksRuntime library pre-installed or installed as part of the clang package.  And furthermore, it may not require linking with any special library to use it either.  See the <a href="#needs">Do I Need This?</a> section for a way to check.

<h2 id="why">Why?</h2>
<p>You want to use the <a href="#blocksdox">Blocks language extension</a>, but when you attempt to build a test program with something like:
<pre>clang -o sample -fblocks sample.c</pre>
you get a linker error something about an undefined <tt>__NSConcreteGlobalBlock</tt> symbol so you try:
<pre>clang -o sample -fblocks sample.c -lBlocksRuntime</pre>
but then you get a linker error about <tt>ld: library not found for -lBlocksRuntime</tt> instead.

This repository can help you build the <tt>libBlocksRuntime.a</tt> library very easily so that you can successfully use the <a href="#blocksdox">Blocks language extension</a> supported by the <tt>-fblocks</tt> option of <a href="http://clang.llvm.org/">the clang compiler</a>.

<p>See the <a href="https://github.com/mackyle/blocksruntime/blob/master/README.txt">README.txt</a> file for further information.</p>

<h2 id="license">License</h2>
<p>Dual licensed under both <a href="http://www.opensource.org/licenses/UoI-NCSA.php">the University of Illinois "BSD-Like" license</a>
and <a href="http://www.opensource.org/licenses/mit-license.php">the MIT license</a>.

See <a href="http://compiler-rt.llvm.org/">here</a>, <a href="http://llvm.org/docs/DeveloperPolicy.html#license">here</a> and the <a href="https://github.com/mackyle/blocksruntime/blob/master/BlocksRuntime/LICENSE.TXT">LICENSE.TXT</a> file for further information.</p>

<h2 id="install">Install</h2>
<p>See the <a href="https://github.com/mackyle/blocksruntime/blob/master/README.txt">README.txt</a> file for further information.</p>

<h2 id="download">Download</h2>
<p>
  You can download this project in either
  <a href="http://github.com/mackyle/blocksruntime/zipball/master">zip</a> or
  <a href="http://github.com/mackyle/blocksruntime/tarball/master">tar</a> formats.
</p>
<p>You can also clone the project with <a href="http://git-scm.com">Git</a>
  by running:
  <pre>$ git clone git://github.com/mackyle/blocksruntime</pre>
</p>
<p>This project also has <a href="http://repo.or.cz/w/blocksruntime.git">a mirror on repo.or.cz</a> which has
<a href="http://repo.or.cz/git-browser/by-commit.html?r=blocksruntime.git">a much better graphic log browser for the project</a>.
</p>

<h2 id="needs">Do I Need This?</h2>
<p><span class="bigger">Here's a checklist to help you decide whether or not you need this library.</span>
<ol>

<li>Do you have the clang compiler?  Try this:
<pre>clang --version</pre>
If it says something like <tt>clang: command not found</tt> then you do not have the clang
compiler so you have no need for this library.

<li>Does your version of clang support <tt>-fblocks</tt>?  Try this:
<pre>echo "void (^b)(void) = ^{};" |
clang -c -o /dev/null -fblocks -x c -</pre>
If you get any kind of error output then your version of clang does not support the <tt>-fblocks</tt>
option so you have no need for this library.

<li>Does your clang installation already include built-in libBlocksRuntime.a support?  Try this:
<pre>echo "int main(){return ^{return 42;}();}" |
clang -o /dev/null -fblocks -x c -</pre>
If you do <em>NOT</em> get any kind of error output then your installation of clang already includes the
Blocks runtime support and you have no need for this library.

<li>Does your clang installation already include a separate BlocksRuntime library?  Try this:
<pre>echo "int main(){return ^{return 42;}();}" |
clang -o /dev/null -fblocks -x c - -lBlocksRuntime</pre>
If you do <em>NOT</em> get any kind of error output then your installation of clang already provides the
Blocks runtime support via the <tt>-lBlocksRuntime</tt> library option and you have no need for
this library (which provides the same thing).

<li>If you got to this step then yes, you do need this library if you want to use the Blocks support
available with your installation of the clang compiler.

</ol>

<h2 id="blocksdox">Blocks Language Extension</h2>

Various Blocks language extension documentation can be found at:

<ul>
<li><a href="http://clang.llvm.org/docs/LanguageExtensions.html#blocks">http://clang.llvm.org/docs/LanguageExtensions.html#blocks</a>
<li><a href="http://clang.llvm.org/docs/BlockLanguageSpec.txt">http://clang.llvm.org/docs/BlockLanguageSpec.txt</a>
<li><a href="http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Blocks">http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Blocks</a>
<li><a href="http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Blocks/Blocks.pdf">http://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Blocks/Blocks.pdf</a>
</ul>

Basically the Blocks language extension adds <a href="http://en.wikipedia.org/wiki/Closure_%28computer_science%29">closure</a> support
to the C/Objective-C/C++/Objective-C++ languages.  If you are familiar with <a href="http://en.wikipedia.org/wiki/SmallTalk">the Smalltalk programming
language</a>, the Blocks language extensions provides something very similar to Smalltalk code blocks.

Here's the <a href="https://github.com/mackyle/blocksruntime/blob/master/sample.c">sample.c</a> file from this repository:
<pre>
/*
   Test your installation by running:

     clang -o sample -fblocks sample.c -lBlocksRuntime && ./sample

   The above line should result in:

     Hello world 2

   If you have everything correctly installed.
*/

#ifndef __BLOCKS__
#error must be compiled with -fblocks option enabled
#endif

#include &lt;stdio.h>
#include &lt;Block.h>

int main()
{
  __block int i;
  i = 0;
  void (^block)() = ^{
    printf("Hello world %d\n", i);
  };
  ++i;
  void (^block2)() = Block_copy(block);
  ++i;
  block2();
  Block_release(block2);
  return 0;
}
</pre>
In the above sample code, both <tt>block</tt> and <tt>block2</tt> are block variables.  And while <tt>i</tt> is an integer variable, the optional <tt>__block</tt> storage class language extension modifies <tt>i</tt>'s behavior when it's accessed from within a block (which doesn't happen in this sample code and so it's not necessary, but is included anyway to verify that the compiler accepts <tt>__block</tt>).

<h2 id="github">GitHub</h2>
<p class="left">
  Visit the GitHub project page (source code etc.) at <a href="http://github.com/mackyle/blocksruntime">http://github.com/mackyle/blocksruntime</a>.
</p>

<!--
<div class="footer">
  get the source code on GitHub : <a href="http://github.com/mackyle/blocksruntime">mackyle/blocksruntime</a>
</div>
-->

</div>
  
</body>
</html>
